<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <!-- CSS -->
    <link rel="stylesheet" href="../static/css/owl.carousel.css">
    <link rel="stylesheet" href="../static/css/font-awesome.min.css">
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/ionicons.min.css">
    <link rel="stylesheet" href="../static/css/animate.css">
    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">


    <link rel="stylesheet" href="../static/bootstrap-table/bootstrap-table.min.css">


    <!-- Js -->
    <script src="../static/js/vendor/modernizr-2.6.2.min.js"></script>
    <script src="../static/js/vendor/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../static/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/owl.carousel.min.js"></script>
    <script src="../static/js/min/waypoints.min.js"></script>
    <script src="../static/js/jquery.counterup.js"></script>
    <script src="../static/js/plugins.js"></script>
    <script src="../static/js/main.js"></script>


    <script src="../static/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="../static/bootstrap-table/locale/bootstrap-table-zh-CN.js"></script>
    <script src="../static/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
      <link rel="stylesheet" href="../static/bootstrap3-editable/css/bootstrap-editable.css">
      <script src="../static/bootstrap-table/extensions/editable/bootstrap-table-editable.min.js"></script>
  </head>
  <body>




  <header>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <!-- header Nav Start -->
          <nav class="navbar navbar-default">
            <div class="container-fluid">
              <!-- Brand and toggle get grouped for better mobile display -->
              <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="hello">
                  <img src="../static/img/logo.png" alt="Logo">
                </a>
              </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
              <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                  <ul class="nav navbar-nav navbar-right">
                    <li><a href="/scdMain/index"><b>首 页</b></a></li>
                    <li><a href="/scdMain/work"><b>工 作</b></a></li>
                    <li><a href="/scdMain/contact"><b>登录/注册</b></a></li>
                    <li><a href="/scdMain/project_base"><b>项目管理</b></a></li>
                    <li><a href="#"><b></b></a></li>
                  </ul>
              </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
          </nav>
        </div>
      </div>
    </div>
  </header><!-- header close -->

    <section id="work-table" style="padding-top: 40px">
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="col-lg-1"></div>
                <div class="col-lg-2 table-hover" >
                    <ul class="nav nav-list list-group">
                        <li class="nav-header">
                            <h3><b>项 目 管 理</b></h3>
                        </li>
                        <li class="active">
                            <a href="/spiMain/project_base">所有项目</a>
                        </li>
                        <li>
                            <a href="/spiMain/spider_base">所有爬虫</a>
                        </li>
                        <li>
                            <a href="/spiMain/spider_pad_base">待运行爬虫</a>
                        </li>
                        <li>
                            <a href="/spiMain/spider_run_base">运行中爬虫</a>
                        </li>

                        <li>
                            <a href="/spiMain/suc_task">已完成任务</a>
                        </li>
                        <li class="nav-header">
                            <h3><b>定 时 计 划</b></h3>
                        </li>
                        <li>
                            <a href="/taskMain/all_task">所有定时计划</a>
                        </li>
                        <li>
                            <a href="/taskMain/effe_task">当前有效计划</a>
                        </li>
                        <li>
                            <a href="/taskMain/stoped_task">已停止计划</a>
                        </li>
                    </ul>
                    <div class="accordion" id="accordion-776774">
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion-776774" href="#accordion-element-508790"><h3 style="color: #000000;">服 务 器</h3></a>
                            </div>
                            <div id="accordion-element-508790" class="accordion-body collapse">
                                <div class="accordion-inner" style="padding-top: 15px; padding-left: 15px;">
                                    <a href="/serverMain/run_status">运行状态</a>
                                </div>
                                <div class="accordion-inner" style="padding-top: 15px; padding-left: 15px;">
                                    <a href="/serverMain/log_status">日志状态</a>
                                </div>
                                <div class="accordion-inner" style="padding-top: 15px; padding-left: 15px;">
                                    <a href="/serverMain/memory">内存使用</a>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-group">
                            <div class="accordion-heading">
                                 <a class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion-776774" href="#accordion-element-32183"><h3 style="color: #000000;">数 据 库</h3></a>
                            </div>
                            <div id="accordion-element-32183" class="accordion-body collapse">
                                <div class="accordion-inner" style="padding-top: 15px; padding-left: 15px;">
                                    <a href="/databaseMain/table">表查看</a>
                                </div>
                                <div class="accordion-inner" style="padding-top: 15px; padding-left: 15px;">
                                    <a href="/databaseMain/table_data">表数据情况</a>
                                </div>
                                <div class="accordion-inner" style="padding-top: 15px; padding-bottom: 25px; padding-left: 15px;">
                                    <a href="/databaseMain/run_status">运行状况</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="alert-info text-center">{{get_flashed_messages()[0]}}</div>
                {% block apsched_form %}
                {% endblock %}
                <div class="col-lg-2">
                    <div>
                        <table class="table table-hover" style="width: auto">
                            <tr><td>用户信息</td></tr>
                            <tr><td><span class="glyphicon glyphicon-user">   {{user}}</span></td></tr>
                            <tr><td><span class="glyphicon glyphicon-envelope">  {{email}}</span></td></tr>
                            <tr><td><span class="glyphicon glyphicon-th-list">  {{typ}}数量：{{counts}}</span></td></tr>
                            <tr><td><span class="glyphicon glyphicon-eye-open">  {{level}}</span></td></tr>
                            <tr><td><a class="btn-default" href="/scdMain/logout">登出</a></td></tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                  <div class="footer-manu">
                    <ul>
                      <li><a href="#">About Us</a></li>
                      <li><a href="#">Contact us</a></li>
                      <li><a href="#">How it works</a></li>
                      <li><a href="#">Support</a></li>
                      <li><a href="#">Terms</a></li>
                    </ul>
                  </div>
                  <p>Copyright &copy; 2017.Company name All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    </body>
<script>
    $(document).ready(function(){
      $("button").click(function(){
        var tr1 = this.parentNode.parentNode;
        var spider_name = tr1.cells[0].innerText;
        var project_name = tr1.cells[1].innerText;
        var act = tr1.cells[5].innerText;
        $.post("/spiMain/action_spider",
        {
          spider:spider_name,
          project:project_name,
          act:act
        }
        );
        window.location.reload()
      });
    });
</script>
<script>
//    模态框位置调整
    function centerModals() {
    　　$('#setSpider').each(function(i) {
    　　　　var $clone = $(this).clone().css('display','block').appendTo('body');
    　　　　var top = Math.round(($clone.height() - $clone.find('.modal-content').height())/3);
    　　　　top = top > 0 ? top : 0;
    　　　　$clone.remove();
    　　　　$(this).find('.modal-content').css("margin-top", top);
    　　});
    };
    function centerModals2() {
    　　$('#myModal').each(function(i) {
    　　　　var $clone = $(this).clone().css('display','block').appendTo('body');
    　　　　var top = Math.round(($clone.height() - $clone.find('.modal-content').height()) / 3);
    　　　　top = top > 0 ? top : 0;
    　　　　$clone.remove();
    　　　　$(this).find('.modal-content').css("margin-top", top);
    　　});
    }
    $('#setSpider').on('show.bs.modal', centerModals);
    $('#myModal').on('show.bs.modal', centerModals2);
    //禁用空白处点击关闭
    $('#setSpider').modal({
    backdrop: 'static',
    keyboard: false,//禁止键盘
    show:false
    });
    //页面大小变化是仍然保证模态框水平垂直居中
    $(window).on('resize', centerModals);
</script>
<script>
//    模态框动态添加输入框组
    function addLabel(obj) {
        $('#spider_modal_body').append("<div class='form-group'> <label for='body' class='col-sm-2 control-label'>内容规则</label> <div class='col-sm-10'> <input type='text' class='form-control' id='body' placeholder='需要获取的内容-匹配规则'>  </div>  </div>")
    }
</script>
<script>
//    可编辑表格初始化代码（测试阶段用）
    $(function(){
    //初始化表格
    $('#subprocessTable').bootstrapTable({
        method:'POST',
        dataType:'json',
        contentType: "application/x-www-form-urlencoded",
        url:'/spiMain/get_rules',
        cache: false,
        striped: true,                              //是否显示行间隔色
        sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）
        showColumns:true,
        pagination:true,
        minimumCountColumns:2,
        pageNumber:1,                       //初始化加载第一页，默认第一页
        pageSize: 10,                       //每页的记录行数（*）
        pageList: [10, 15, 20, 25],        //可供选择的每页的行数（*）
        uniqueId: "id",                     //每一行的唯一标识，一般为主键列
        showExport: true,
        exportDataType: 'all',
        exportTypes:[ 'csv', 'txt', 'sql', 'doc', 'excel', 'xlsx', 'pdf'],  //导出文件类型
        onEditableSave: function (field, row, oldValue, $el) {
            $.ajax({
                type:'post',
                url:'/spiMain/modify_rules',
                data:row,
                dataType:'JSON',
                success: function (data, status) {
                    if (status == "success") {
                        alert("编辑成功");
                    }
                },
                error: function () {
                    alert("Error");
                },
                complete: function () {

                }
            });
        },
      onEditableHidden: function(field, row, $el, reason) { // 当编辑状态被隐藏时触发
          if(reason === 'save') {
              var $td = $el.closest('tr').children();
          //    $td.eq(-1).html((row.price*row.number).toFixed(2));
          //    $el.closest('tr').next().find('.editable').editable('show'); //编辑状态向下一行移动
          } else if(reason === 'nochange') {
              $el.closest('tr').next().find('.editable').editable('show');
          }
      },
        columns: [{
            field: 'id',
            title: '序号'
        }, {
            field: 'allowed_domains',
            title: '限定域名',
            editable: {
                type: 'text',
                validate: function (value) {
                    if ($.trim(value) == '') {
                        return '姓名不能为空!';
                    }
                }
            }
        }, {
            field: 'start_url',
            title: '起始url',
            editable: {
                type: 'select',
                pk: 1,
                source: [
                    {value: 1, text: '男'},
                    {value: 2, text: '女'},
                ],
                noeditFormatter: function (value,row,index) {
                    var result={filed:"start_url",value:value,class:"badge",style:"background:#333;padding:5px 10px;"};
                    return result;
                }
            }
        },  {
            field: 'next_page',
            title: '下一页规则',
            editable: {
                type: 'text',
                format: 'yyyy-mm-dd',
                viewformat: 'yyyy-mm-dd',
                datepicker: {
                    weekStart: 1
                },
                noeditFormatter: function (value,row,index) {
                    var result={filed:"next_page",value:value,class:"badge",style:"background:#333;padding:5px 10px;"};
                    return result;
                }
            }
        }]
    });})
</script>
</html>
